install
#text
graphical
unsupported_hardware
url --url=<%=repo%>
# eula --agreed
lang en_US.UTF-8
keyboard 'us'
timezone America/Los_Angeles --isUtc
firewall --enabled --http --ssh
selinux --permissive
bootloader --location=mbr --driveorder=sda --append="crashkernel=auth rhgb"
services --enabled=NetworkManager,sshd
network --device=<%=macaddress%> --noipv6 --activate

#enable syslog
logging --host=<%=server%> --level=info

authconfig --enableshadow --passalgo=sha512 --enablefingerprint

#Set the root account
rootpw --iscrypted <%=rootEncryptedPassword%>

#create all users
<% for (var i = 0; i < users.length; i++) { %>
    user --name=<%=users[i].name%> --uid=<%=users[i].uid%> --iscrypted --password <%=users[i].encryptedPassword%>
<% } %>

# Disk Partitioning
zerombr
clearpart --all --initlabel
#clearpart --all --initlabel --drives=sda
autopart
# END of Disk Partitioning

# Make sure we reboot into the new system when we are finished
reboot

# Package Selection
%packages --nobase --excludedocs
@core
-*firmware
-iscsi*
-fcoe*
-b43-openfwwf
kernel-firmware
-efibootmgr
wget
sudo
perl
libselinux-python
net-tools
%end

%pre
%end

%post --log=/root/install-post.log
(
# PLACE YOUR POST DIRECTIVES HERE
PATH=/bin:/sbin:/usr/bin:/usr/sbin
export PATH
#echo "renasar ALL=(ALL)       ALL" >> /etc/sudoers
#echo "emc ALL=(ALL)       ALL" >> /etc/sudoers

# copying of SSH key
<% if (typeof rootSshKey !== 'undefined') { %>
    mkdir /root/.ssh
    echo <%=rootSshKey%> > /root/.ssh/authorized_keys
    chown -R root:root /root/.ssh
<% } %>
<% for (var i = 0; i < users.length; i++) { %>
    <% if (typeof users[i].sshKey !== 'undefined') { %>
        mkdir /home/<%=users[i].name%>/.ssh
        echo <%=users[i].sshKey%> > /home/<%=users[i].name%>/.ssh/authorized_keys
        chown -R <%=users[i].name%>:<%=users[i].name%> /home/<%=users[i].name%>/.ssh
    <% } %>
<% } %>

#set hostname
echo <%=hostname%> > /etc/hostname
echo -e "NETWORKING=yes\nHOSTNAME=<%=hostname%>.<%=domain%>" > /etc/sysconfig/network

#signify ORA the installation completed
/usr/bin/wget --spider http://<%=server%>:<%=port%>/api/common/templates/renasar-ansible.pub

) 2>&1 >/root/install-post-sh.log
EOF
%end
